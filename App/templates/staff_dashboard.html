<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Staff Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script defer src="{{ url_for('static', filename='js/protect.js') }}"></script>
</head>
<body>
  <header>
    <h1>Welcome, {{ user.username }}</h1>
    <button onclick="logout()">Logout</button>
  </header>
  
  <main>
    <h2>Your Shifts</h2>
    <div id="roster"></div>

    <h2>Attendance</h2>
    <div>
      <input type="number" id="shiftId" placeholder="Shift ID" />
      <button onclick="timeIn()">Time In</button>
      <button onclick="timeOut()">Time Out</button>
    </div>
  </main>

  <script>
    const token = localStorage.getItem('token');
    if (!token) {
      window.location.href = "/";
    }

    // Fetch roster for logged-in staff
    fetch('/api/v1/staff/roster', {
      headers: { 'Authorization': `Bearer ${token}` }
    })
    .then(res => {
      if (res.status === 401) {
        logout();
      }
      return res.json();
    })
    .then(data => {
      const rosterDiv = document.getElementById('roster');
      if (Array.isArray(data) && data.length > 0) {
        rosterDiv.innerHTML = data.map(s => 
          `<p>Shift ${s.shiftId}: ${s.startTime} - ${s.endTime}</p>`
        ).join('');
      } else {
        rosterDiv.innerHTML = "<p>No shifts found.</p>";
      }
    });

    function timeIn(){
      const shiftId = document.getElementById('shiftId').value;
      fetch(`/api/v1/shifts/${shiftId}/time-in`, {
        method: 'POST',
        headers: { 'Authorization': `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(data => alert(data.message || "Time in recorded."));
    }

    function timeOut(){
      const shiftId = document.getElementById('shiftId').value;
      fetch(`/api/v1/shifts/${shiftId}/time-out`, {
        method: 'POST',
        headers: { 'Authorization': `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(data => alert(data.message || "Time out recorded."));
    }

    function logout(){
      localStorage.removeItem('token');
      localStorage.removeItem('userType');
      window.location.href = "/";
    }
  </script>

  <script defer src="{{ url_for('static', filename='js/protect.js') }}"></script>

</body>
</html>
